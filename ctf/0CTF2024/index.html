<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/wednesday/libs/katex/katex.min.css"> <link rel=stylesheet  href="/wednesday/libs/highlight/styles/base16/chalk.min.css" /> <link rel=stylesheet  href="/wednesday/css/franklin.css" /> <link rel=stylesheet  href="/wednesday/css/tufte.css" /> <link rel=stylesheet  href="/wednesday/css/latex.css" /> <link rel=stylesheet  href="/wednesday/css/adjust.css" /> <link rel=icon  href="/wednesday/assets/favicon.png" /> <title>0CTF 2024 - ZKPQC1</title> <div id=layout > <div id=menu > <ul> <li><a href="/wednesday/">home</a> <li><a href="/wednesday/about/">about</a> <li><a href="/wednesday/ctf/">ctf</a> </ul> </div> <div id=main > <div class=franklin-content ><h1 id=0ctf_2024_-_zkpqc1 ><a href="#0ctf_2024_-_zkpqc1" class=header-anchor >0CTF 2024 - ZKPQC1</a></h1> <p>Big thank you to <a href="https://0ops.sjtu.cn/">Team 0ops</a> for hosting this event and writing these great challenges&#33;</p> <p>During the competition I spent around 14 hours on this challenge, split between 12 hours on the first day, and 2 hours on the second. Ultimately, the solution hinged on a neat bit of isogeny trivia which I found quite interesting.</p> <div class=franklin-toc ><ol><li><a href="#zkpqc1">ZKPQC1</a><li><a href="#solve_script">Solve script</a><li><a href="#flag">Flag</a></ol></div> <h2 id=zkpqc1 ><a href="#zkpqc1" class=header-anchor >ZKPQC1</a></h2> <p>This challenge takes place over the following SIDH parameters</p> <div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.25em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mn>49</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mn>36</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>p</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mi>a</mi></msup><mo>⋅</mo><msup><mn>3</mn><mi>b</mi></msup><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi mathvariant=double-struck >F</mi><msup><mi>p</mi><mn>2</mn></msup></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mfrac><msub><mi mathvariant=double-struck >F</mi><mi>p</mi></msub><mrow><mo stretchy=false >(</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo stretchy=false >)</mo></mrow></mfrac><mo>=</mo><msub><mi mathvariant=double-struck >F</mi><mi>p</mi></msub><mo stretchy=false >[</mo><mi>i</mi><mo stretchy=false >]</mo><mi mathvariant=normal >.</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} a &amp;= 49\\ b &amp;= 36\\ p &amp;= 2^a \cdot 3^b - 1 \\ \mathbb{F}_{p^2} &amp;= \frac{\mathbb{F}_{p}}{(x^2 + 1)} = \mathbb{F}_p[i]. \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:7.161em;vertical-align:-3.3305em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.8305em;"><span style="top:-6.3564em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class="mord mathnormal">a</span></span></span><span style="top:-4.8564em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class="mord mathnormal">b</span></span></span><span style="top:-3.2973em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class="mord mathnormal">p</span></span></span><span style="top:-1.2714em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class=mord ><span class="mord mathbb">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.5224em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.3137em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3305em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.8305em;"><span style="top:-6.3564em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord >49</span></span></span><span style="top:-4.8564em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord >36</span></span></span><span style="top:-3.2973em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class=mord >3</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord >1</span></span></span><span style="top:-1.2714em;"><span class=pstrut  style="height:3.3659em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3659em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbb">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathbb">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mclose >]</span><span class=mord >.</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3305em;"><span></span></span></span></span></span></span></span></span></span></span></span></div> <p>The starting curve is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub><mo>:</mo><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>6</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">E_0: y^2 = x^3 + 6x^2 + x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0085em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8974em;vertical-align:-0.0833em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8974em;vertical-align:-0.0833em;"></span><span class=mord >6</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>. </p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> signal
<span class=hljs-keyword >from</span> hashlib <span class=hljs-keyword >import</span> sha256
<span class=hljs-keyword >from</span> Crypto.Util.number <span class=hljs-keyword >import</span> bytes_to_long
<span class=hljs-keyword >from</span> secret <span class=hljs-keyword >import</span> FLAG

<span class=hljs-keyword >def</span> <span class="hljs-title function_">_handle_timeout</span>(<span class=hljs-params >signum, frame</span>):
    <span class=hljs-keyword >raise</span> TimeoutError(<span class=hljs-string >&#x27;function timeout&#x27;</span>)

FAKE_NUM = <span class=hljs-number >3</span>

<span class=hljs-comment ># Base field</span>
a = <span class=hljs-number >49</span>
b = <span class=hljs-number >36</span>
p = <span class=hljs-number >2</span>**a * <span class=hljs-number >3</span>**b - <span class=hljs-number >1</span>


<span class=hljs-keyword >def</span> <span class="hljs-title function_">get_canonical_basis</span>(<span class=hljs-params >E, l, e</span>):
    <span class=hljs-keyword >assert</span> (p+<span class=hljs-number >1</span>) % l^e == <span class=hljs-number >0</span>
    P = E(<span class=hljs-number >0</span>)
    <span class=hljs-keyword >while</span> (l^(e-<span class=hljs-number >1</span>))*P == <span class=hljs-number >0</span>:
        P = ((p+<span class=hljs-number >1</span>) // l^e) * E.random_point()
    Q = P
    <span class=hljs-keyword >while</span> P.weil_pairing(Q, l^e)^(l^(e-<span class=hljs-number >1</span>)) == <span class=hljs-number >1</span>:
        Q = ((p+<span class=hljs-number >1</span>) // l^e) * E.random_point()
    <span class=hljs-keyword >return</span> P, Q

<span class=hljs-keyword >def</span> <span class="hljs-title function_">gen_torsion_points</span>(<span class=hljs-params >E</span>):
    Pa, Qa = get_canonical_basis(E, <span class=hljs-number >2</span>, a)
    Pb, Qb = get_canonical_basis(E, <span class=hljs-number >3</span>, b)
    <span class=hljs-keyword >return</span> Pa, Qa, Pb, Qb


<span class=hljs-keyword >def</span> <span class="hljs-title function_">hash_function</span>(<span class=hljs-params >J</span>):
    <span class=hljs-keyword >return</span> (bytes_to_long(sha256(<span class=hljs-built_in >str</span>(J[<span class=hljs-number >0</span>]).encode()).digest()) // <span class=hljs-number >2</span> * <span class=hljs-number >2</span> + <span class=hljs-number >1</span>)  % <span class=hljs-number >2</span>^a, \
        (bytes_to_long(sha256(<span class=hljs-built_in >str</span>(J[<span class=hljs-number >1</span>]).encode()).digest()) // <span class=hljs-number >2</span> * <span class=hljs-number >2</span> + <span class=hljs-number >1</span>) % <span class=hljs-number >2</span>^a


<span class=hljs-keyword >def</span> <span class="hljs-title function_">get_Fp2</span>(<span class=hljs-params >i</span>):
    <span class=hljs-keyword >return</span> <span class=hljs-built_in >int</span>(<span class=hljs-built_in >input</span>()) + <span class=hljs-built_in >int</span>(<span class=hljs-built_in >input</span>())*i


<span class=hljs-keyword >def</span> <span class="hljs-title function_">get_ECC_and_points</span>():
    Ea4 = get_Fp2(i)
    Ea6 = get_Fp2(i)
    Ea = EllipticCurve(Fp2, [<span class=hljs-number >0</span>, <span class=hljs-number >6</span>, <span class=hljs-number >0</span>, Ea4, Ea6])
    P = Ea(get_Fp2(i), get_Fp2(i))
    Q = Ea(get_Fp2(i), get_Fp2(i))
    <span class=hljs-keyword >return</span> Ea, P, Q


<span class=hljs-keyword >class</span> <span class="hljs-title class_">ZKP</span>:

    <span class=hljs-keyword >def</span> <span class="hljs-title function_">__init__</span>(<span class=hljs-params >self, E, kernel</span>):
        <span class="hljs-variable language_">self</span>.P0, <span class="hljs-variable language_">self</span>.Q0 = get_canonical_basis(E, <span class=hljs-number >3</span>, b)
        <span class="hljs-variable language_">self</span>.E0 = E
        <span class="hljs-variable language_">self</span>.chall_lst = []
        <span class="hljs-variable language_">self</span>.CHALL_NUM = <span class=hljs-number >16</span>
        <span class="hljs-variable language_">self</span>.kernel = kernel
        <span class="hljs-variable language_">self</span>.ker_phi = <span class="hljs-variable language_">self</span>.E0.isogeny(<span class="hljs-variable language_">self</span>.kernel, algorithm=<span class=hljs-string >&quot;factored&quot;</span>)
        <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;<span class=hljs-subst >{self.P0 = }</span>&quot;</span>)
        <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;<span class=hljs-subst >{self.Q0 = }</span>&quot;</span>)


    <span class=hljs-keyword >def</span> <span class="hljs-title function_">_commit</span>(<span class=hljs-params >self</span>):
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Give me E2:&quot;</span>)
        E2a4 = get_Fp2(i)
        E2a6 = get_Fp2(i)
        <span class="hljs-variable language_">self</span>.E2 = EllipticCurve(Fp2, [<span class=hljs-number >0</span>, <span class=hljs-number >6</span>, <span class=hljs-number >0</span>, E2a4, E2a6])

        <span class="hljs-variable language_">self</span>.P2, <span class="hljs-variable language_">self</span>.Q2 = get_canonical_basis(<span class="hljs-variable language_">self</span>.E2, <span class=hljs-number >3</span>, b)
        <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;<span class=hljs-subst >{self.P2 = }</span>&quot;</span>)
        <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;<span class=hljs-subst >{self.Q2 = }</span>&quot;</span>)

        <span class="hljs-variable language_">self</span>.E3, <span class="hljs-variable language_">self</span>.P3, <span class="hljs-variable language_">self</span>.Q3 = get_ECC_and_points()
        <span class=hljs-keyword >assert</span> <span class="hljs-variable language_">self</span>.E3.is_supersingular()


    <span class=hljs-keyword >def</span> <span class="hljs-title function_">_challenge</span>(<span class=hljs-params >self, c=<span class=hljs-literal >None</span></span>):
        <span class=hljs-keyword >if</span> c <span class=hljs-keyword >is</span> <span class=hljs-literal >None</span>:
            <span class="hljs-variable language_">self</span>.chall = randint(<span class=hljs-number >0</span>,<span class=hljs-number >1</span>)
        <span class=hljs-keyword >else</span>:
            <span class="hljs-variable language_">self</span>.chall = c
        <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;chall = <span class=hljs-subst >{self.chall}</span>&quot;</span>)


    <span class=hljs-keyword >def</span> <span class="hljs-title function_">_verify</span>(<span class=hljs-params >self</span>):
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Your response:&quot;</span>)

        <span class=hljs-keyword >if</span> <span class="hljs-variable language_">self</span>.chall:
            Kphi_ = <span class="hljs-variable language_">self</span>.E2(get_Fp2(i), get_Fp2(i))
            <span class=hljs-keyword >assert</span> <span class=hljs-number >2</span>^a * <span class="hljs-variable language_">self</span>.E2(Kphi_) == <span class="hljs-variable language_">self</span>.E2(<span class=hljs-number >0</span>)
            phi_ = <span class="hljs-variable language_">self</span>.E2.isogeny(Kphi_, algorithm=<span class=hljs-string >&quot;factored&quot;</span>)
            <span class=hljs-keyword >assert</span> <span class="hljs-variable language_">self</span>.E3.j_invariant() == phi_.codomain().j_invariant()
            <span class=hljs-keyword >assert</span> phi_(<span class="hljs-variable language_">self</span>.P2) == <span class="hljs-variable language_">self</span>.P3 <span class=hljs-keyword >and</span> phi_(<span class="hljs-variable language_">self</span>.Q2) == <span class="hljs-variable language_">self</span>.Q3
        <span class=hljs-keyword >else</span>:
            resp = <span class=hljs-built_in >input</span>()
            sigma, delta = [<span class=hljs-built_in >int</span>(_) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> resp.split(<span class=hljs-string >&quot;,&quot;</span>)]
            Kbar_psi = sigma * <span class="hljs-variable language_">self</span>.P2 + delta * <span class="hljs-variable language_">self</span>.Q2
            Kbar_psi_ = sigma * <span class="hljs-variable language_">self</span>.P3 + delta * <span class="hljs-variable language_">self</span>.Q3
            <span class=hljs-keyword >assert</span> <span class=hljs-number >3</span>^b * Kbar_psi == <span class="hljs-variable language_">self</span>.E2(<span class=hljs-number >0</span>) <span class=hljs-keyword >and</span> <span class=hljs-number >3</span>^b * Kbar_psi_ == <span class="hljs-variable language_">self</span>.E3(<span class=hljs-number >0</span>)
            E0_ = <span class="hljs-variable language_">self</span>.E2.isogeny(Kbar_psi, algorithm=<span class=hljs-string >&quot;factored&quot;</span>).codomain()
            E1_ = <span class="hljs-variable language_">self</span>.E3.isogeny(Kbar_psi_, algorithm=<span class=hljs-string >&quot;factored&quot;</span>).codomain()
            <span class=hljs-keyword >assert</span> E0.j_invariant() == E0_.j_invariant() <span class=hljs-keyword >and</span> EA.j_invariant() == E1_.j_invariant()
            <span class=hljs-keyword >assert</span> <span class="hljs-variable language_">self</span>.ker_phi.codomain().j_invariant() == E1_.j_invariant()
        <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>


    <span class=hljs-keyword >def</span> <span class="hljs-title function_">run</span>(<span class=hljs-params >self</span>):
        <span class="hljs-variable language_">self</span>.chall_lst = [randint(<span class=hljs-number >0</span>,<span class=hljs-number >1</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class="hljs-variable language_">self</span>.CHALL_NUM)]
        <span class=hljs-keyword >while</span> <span class=hljs-built_in >sum</span>(<span class="hljs-variable language_">self</span>.chall_lst) == <span class=hljs-number >0</span> <span class=hljs-keyword >or</span> <span class=hljs-built_in >sum</span>(<span class="hljs-variable language_">self</span>.chall_lst) == <span class="hljs-variable language_">self</span>.CHALL_NUM:
            <span class="hljs-variable language_">self</span>.chall_lst = [randint(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class="hljs-variable language_">self</span>.CHALL_NUM)]

        <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class="hljs-variable language_">self</span>.CHALL_NUM):
            <span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;Now, for the <span class=hljs-subst >{_}</span> round of PoK:&quot;</span>)
            <span class="hljs-variable language_">self</span>._commit()
            <span class="hljs-variable language_">self</span>._challenge(<span class="hljs-variable language_">self</span>.chall_lst[_])
            <span class=hljs-keyword >if</span> <span class=hljs-keyword >not</span> <span class="hljs-variable language_">self</span>._verify():
                <span class=hljs-keyword >return</span> <span class=hljs-literal >False</span>
        <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>

timeout = <span class=hljs-number >90</span>
signal.signal(signal.SIGALRM, _handle_timeout)
signal.alarm(timeout)

Fpx = PolynomialRing(GF(p), <span class=hljs-string >&quot;x&quot;</span>)
x = Fpx.gen()
Fp2.&lt;i&gt; = GF(p**<span class=hljs-number >2</span>, modulus=[<span class=hljs-number >1</span>,<span class=hljs-number >0</span>,<span class=hljs-number >1</span>])

E0 = EllipticCurve(Fp2, [<span class=hljs-number >0</span>, <span class=hljs-number >6</span>, <span class=hljs-number >0</span>, <span class=hljs-number >1</span>, <span class=hljs-number >0</span>])
E0.set_order((p+<span class=hljs-number >1</span>)**<span class=hljs-number >2</span>)

Pa,Qa,Pb,Qb = gen_torsion_points(E0)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;Pa = <span class=hljs-subst >{Pa}</span>&quot;</span>)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;Qa = <span class=hljs-subst >{Qa}</span>&quot;</span>)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;Pb = <span class=hljs-subst >{Pb}</span>&quot;</span>)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;Qb = <span class=hljs-subst >{Qb}</span>&quot;</span>)

Ea, phiPb, phiQb = get_ECC_and_points()
<span class=hljs-keyword >assert</span> Ea.is_supersingular()

Sb = randint(<span class=hljs-number >0</span>, <span class=hljs-number >3</span>^b-<span class=hljs-number >1</span>)
Tb = randint(<span class=hljs-number >0</span>, <span class=hljs-number >3</span>^b-<span class=hljs-number >1</span>)
R = Sb * Pb + Tb * Qb
psi = E0.isogeny(R, algorithm=<span class=hljs-string >&quot;factored&quot;</span>)
Eb, psiPa, psiQa = psi.codomain(), psi(Pa), psi(Qa)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;<span class=hljs-subst >{Eb}</span>&quot;</span>)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;psiPa = <span class=hljs-subst >{psiPa}</span>&quot;</span>)
<span class=hljs-built_in >print</span>(<span class=hljs-string >f&quot;psiQa = <span class=hljs-subst >{psiQa}</span>&quot;</span>)


J = Ea.isogeny(Sb * phiPb + Tb * phiQb, algorithm=<span class=hljs-string >&quot;factored&quot;</span>).codomain().j_invariant()
Sa, Ta = hash_function(J)
EA = E0.isogeny(Sa * Pa + Ta * Qa, algorithm=<span class=hljs-string >&quot;factored&quot;</span>).codomain()

s = <span class=hljs-built_in >set</span>()
<span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(FAKE_NUM):
    <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Give me your share: &quot;</span>)

    kernel = E0(get_Fp2(i), get_Fp2(i))
    <span class=hljs-keyword >assert</span> <span class=hljs-number >2</span>^a * kernel == E0(<span class=hljs-number >0</span>) <span class=hljs-keyword >and</span> <span class=hljs-number >2</span>^(a-<span class=hljs-number >2</span>) * kernel != E0(<span class=hljs-number >0</span>)
    zkp = ZKP(E0, kernel)

    <span class=hljs-keyword >if</span> <span class=hljs-built_in >all</span>(kernel.weil_pairing(PP, <span class=hljs-number >2</span>^a) != <span class=hljs-number >1</span> <span class=hljs-keyword >for</span> PP <span class=hljs-keyword >in</span> s) <span class=hljs-keyword >and</span> zkp.run():
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Good Job!&quot;</span>)
        s.add(kernel)
    <span class=hljs-keyword >else</span>:
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Out, you are cheating!&quot;</span>)
        <span class=hljs-keyword >break</span>

<span class=hljs-keyword >if</span> <span class=hljs-built_in >len</span>(s) == FAKE_NUM:
    <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;You are a master of isogeny and ZKP.&quot;</span>)
    <span class=hljs-built_in >print</span>(FLAG)</code></pre> <p>In the first part of the challenge, we are asked to perform a SIDH key exchange with the server in order to derive a shared <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>-invariant <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span>. Since we don&#39;t care about the secrecy of this exchange, we can perform this exchange somewhat half-heartedly as long as we arrive at the same <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>-invariant as the server. So for our &quot;secret&quot; isogeny, we will choose <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>φ</mi><mo>=</mo><mrow><mi mathvariant=normal >i</mi><mi mathvariant=normal >d</mi></mrow></mrow><annotation encoding="application/x-tex">\varphi = \mathrm{id}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">φ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6944em;"></span><span class=mord ><span class="mord mathrm">id</span></span></span></span></span> and send the parameters </p> <div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>E</mi><mi>a</mi></msub><mo>=</mo><msub><mi>E</mi><mn>0</mn></msub><mo separator=true >,</mo><mtext> </mtext><mi>φ</mi><mo stretchy=false >(</mo><msub><mi>P</mi><mi>b</mi></msub><mo stretchy=false >)</mo><mo>=</mo><msub><mi>P</mi><mi>b</mi></msub><mo separator=true >,</mo><mtext> </mtext><mi>φ</mi><mo stretchy=false >(</mo><msub><mi>Q</mi><mi>b</mi></msub><mo stretchy=false >)</mo><mo>=</mo><msub><mi>Q</mi><mi>b</mi></msub><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> E_a = E_0, \;\varphi(P_b) = P_b, \;\varphi(Q_b) = Q_b. </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">φ</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8778em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >.</span></span></span></span></span></div> <p>The server will then derive the shared curve</p> <div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><msub><mi>E</mi><mi>a</mi></msub><mrow><mo stretchy=false >⟨</mo><mo stretchy=false >[</mo><msub><mi>s</mi><mi>b</mi></msub><mo stretchy=false >]</mo><mi>φ</mi><mo stretchy=false >(</mo><msub><mi>P</mi><mi>b</mi></msub><mo stretchy=false >)</mo><mo>+</mo><mo stretchy=false >[</mo><msub><mi>t</mi><mi>b</mi></msub><mo stretchy=false >]</mo><mi>φ</mi><mo stretchy=false >(</mo><msub><mi>Q</mi><mi>b</mi></msub><mo stretchy=false >)</mo><mo stretchy=false >⟩</mo></mrow></mfrac><mo>=</mo><mfrac><msub><mi>E</mi><mn>0</mn></msub><mrow><mo stretchy=false >⟨</mo><mo stretchy=false >[</mo><msub><mi>s</mi><mi>b</mi></msub><mo stretchy=false >]</mo><msub><mi>P</mi><mi>b</mi></msub><mo>+</mo><mo stretchy=false >[</mo><msub><mi>t</mi><mi>b</mi></msub><mo stretchy=false >]</mo><msub><mi>Q</mi><mi>b</mi></msub><mo stretchy=false >⟩</mo></mrow></mfrac><mo>=</mo><msub><mi>E</mi><mi>b</mi></msub><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{E_a}{\langle [s_b]\varphi(P_b) + [t_b]\varphi(Q_b) \rangle} = \frac{E_0}{\langle [s_b]P_b + [t_b]Q_b \rangle} = E_b, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.2963em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >⟨[</span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class="mord mathnormal">φ</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mopen >[</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class="mord mathnormal">φ</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)⟩</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.2963em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >⟨[</span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mopen >[</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >⟩</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8778em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span></span></span></span></span></div> <p>which is known to us, and from there we can derived the shared <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>-invariant as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><mi>j</mi><mo stretchy=false >(</mo><msub><mi>E</mi><mi>b</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">J = j(E_b)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>.</p> <p>Since we know the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>-invariant <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span>, then we also know the secret scalars <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>a</mi></msub><mo separator=true >,</mo><msub><mi>t</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">s_a, t_a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8095em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and from that the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>a</mi></msup></mrow><annotation encoding="application/x-tex">2^a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6644em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span></span></span></span>-isogeny <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi><mo>:</mo><msub><mi>E</mi><mn>0</mn></msub><mo>⟶</mo><msub><mi>E</mi><mi>A</mi></msub><mo>≅</mo><msub><mi>E</mi><mn>0</mn></msub><mi mathvariant=normal >/</mi><mo stretchy=false >⟨</mo><mo stretchy=false >[</mo><msub><mi>s</mi><mi>a</mi></msub><mo stretchy=false >]</mo><msub><mi>P</mi><mi>a</mi></msub><mo>+</mo><mo stretchy=false >[</mo><msub><mi>t</mi><mi>a</mi></msub><mo stretchy=false >]</mo><msub><mi>Q</mi><mi>a</mi></msub><mo stretchy=false >⟩</mo></mrow><annotation encoding="application/x-tex">\Phi: E_0 \longrightarrow E_A \cong E_0/\langle [s_a]P_a + [t_a]Q_a \rangle</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >⟶</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≅</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >/</span><span class=mopen >⟨[</span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >⟩</span></span></span></span>.</p> <p>After the key exchange, the server will then ask us to prove knowledge of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span></span></span></span> three times, using the <a href="https://eprint.iacr.org/2022/475.pdf">SIDH-sign proof of knowledge</a>. Since we already know <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span></span></span></span> this is not too difficult, as we can just follow the protocol as an honest prover. Moreover since we don&#39;t care about the zero-knowledge component of the proof &#40;the server already knows our isogeny&#41;, we can choose <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>2</mn></msub><mo>=</mo><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_2 = E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>3</mn></msub><mo>=</mo><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_3 = E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as our commitment to greatly simplify the proof. </p> <p>Completing the proof three times will give us a flag, so the only problem remaining is a set of two checks we must pass prior to the ZKP starting.</p> <pre><code class="python hljs">s = <span class=hljs-built_in >set</span>()
<span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(FAKE_NUM): <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Give me your share: &quot;</span>)
    kernel = E0(get_Fp2(i), get_Fp2(i))
    <span class=hljs-keyword >assert</span> <span class=hljs-number >2</span>^a * kernel == E0(<span class=hljs-number >0</span>) <span class=hljs-keyword >and</span> <span class=hljs-number >2</span>^(a-<span class=hljs-number >2</span>) * kernel != E0(<span class=hljs-number >0</span>)
    zkp = ZKP(E0, kernel)

    <span class=hljs-keyword >if</span> <span class=hljs-built_in >all</span>(kernel.weil_pairing(PP, <span class=hljs-number >2</span>^a) != <span class=hljs-number >1</span> <span class=hljs-keyword >for</span> PP <span class=hljs-keyword >in</span> s) <span class=hljs-keyword >and</span> zkp.run():
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Good Job!&quot;</span>)
        s.add(kernel)
    <span class=hljs-keyword >else</span>:
        <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Out, you are cheating!&quot;</span>)
        <span class=hljs-keyword >break</span></code></pre> <p>At the beginning of each ZKP iteration, we are asked to supply a kernel point which will generate an isogeny from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. The checks above require us to submit three distinct kernel points. Moreover the condition</p> <pre><code class="python hljs"><span class=hljs-keyword >if</span> <span class=hljs-built_in >all</span>(kernel.weil_pairing(PP, <span class=hljs-number >2</span>^a) != <span class=hljs-number >1</span> <span class=hljs-keyword >for</span> PP <span class=hljs-keyword >in</span> s) <span class=hljs-keyword >and</span> zkp.run():
      ...</code></pre> <p>requires that the three kernel points be linearly independent. This means that we must find three distinct paths through the 2-isogeny graph from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p> <p>In general, this problem is quite hard, and for the references in the literature which I could find, the methods essentially boiled down to a <a href="https://eprint.iacr.org/2021/1051.pdf">brute force search through the isogeny graph</a>.</p> <p>Luckily, our initial curve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is an easy special case of this problem as it is adjacent to the curve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>:</mo><msup><mi>y</mi><mn>2</mn></msup><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">E: y^2 = x^3 + x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0085em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8974em;vertical-align:-0.0833em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>-invariant <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1728</mn></mrow><annotation encoding="application/x-tex">1728</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >1728</span></span></span></span>. The curve <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> is special as its only 2-isogenous neighbours are <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> itself, whereas other curves usually have three 2-isogenous neighbours generated by the linear combinations <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo separator=true >,</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">P, Q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>+</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">P + Q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> of a 2-torsion basis <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>P</mi><mo separator=true >,</mo><mi>Q</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(P, Q)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class=mclose >)</span></span></span></span> respectively.</p> <div class=small_image ><div class=invert_image ><img src="/wednesday/assets/0CTF2024/cd.svg" alt=Diagram  /></div></div> <p>Using the notations in the above diagram, this means that any isogeny from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> which factors through <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> must necessarily return to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> via one of either <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>φ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\varphi_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> or <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>φ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\varphi_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> before continuing onto <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. For example, a possible sequence starting from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> could be</p> <div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mover accent=true ><msub><mi>φ</mi><mn>1</mn></msub><mo>^</mo></mover><mo>→</mo><msub><mi>φ</mi><mn>3</mn></msub><mo>→</mo><msub><mi>φ</mi><mn>2</mn></msub><mo>→</mo><msub><mi>ϕ</mi><mn>1</mn></msub><mo>→</mo><mo>…</mo></mrow><annotation encoding="application/x-tex"> \hat{\varphi_1} \rightarrow \varphi_3 \rightarrow \varphi_2 \rightarrow \phi_1 \rightarrow \ldots </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6944em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.25em;"><span class=mord >^</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.8889em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.123em;"></span><span class=minner >…</span></span></span></span></span></div> <p>From this sequence, we can obtain two other distinct isogenies from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">E_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> by altering the return isogeny from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">E_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, or by cutting out the traversal to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> entirely.</p> <div class=nonumber ><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.25em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mover accent=true ><msub><mi>φ</mi><mn>1</mn></msub><mo>^</mo></mover><mo>→</mo><msub><mi>φ</mi><mn>3</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>→</mo><msub><mi>φ</mi><mn>2</mn></msub><mo>→</mo><msub><mi>ϕ</mi><mn>1</mn></msub><mo>→</mo><mo>…</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mover accent=true ><msub><mi>φ</mi><mn>1</mn></msub><mo>^</mo></mover><mo>→</mo><msub><mi>φ</mi><mn>3</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>→</mo><msub><mi>φ</mi><mn>1</mn></msub><mo>→</mo><msub><mi>ϕ</mi><mn>1</mn></msub><mo>→</mo><mo>…</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><msub><mi>ϕ</mi><mn>1</mn></msub><mo>→</mo><mo>…</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \hat{\varphi_1} \rightarrow \varphi_3 &amp;\rightarrow \varphi_2 \rightarrow \phi_1 \rightarrow \ldots\\ \hat{\varphi_1} \rightarrow \varphi_3 &amp;\rightarrow \varphi_1 \rightarrow \phi_1 \rightarrow \ldots\\ &amp;\phi_1 \rightarrow \ldots\\ \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:4.5em;vertical-align:-2em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5em;"><span style="top:-4.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6944em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.25em;"><span class=mord >^</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6944em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.25em;"><span class=mord >^</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5em;"><span style="top:-4.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=minner >…</span></span></span><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=minner >…</span></span></span><span style="top:-1.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=minner >…</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span></div> <p>Note that cutting out the traversal to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> reduces the degree of the isogeny by 2 to the power of the number of isogenes we truncated. This is important as we must ensure our isogeny&#39;s degree remains above <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>a</mi><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{a-2}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> in order to pass the check</p> <pre><code class="python hljs">kernel = E0(get_Fp2(i), get_Fp2(i))
<span class=hljs-keyword >assert</span> <span class=hljs-number >2</span>^a * kernel == E0(<span class=hljs-number >0</span>) <span class=hljs-keyword >and</span> <span class=hljs-number >2</span>^(a-<span class=hljs-number >2</span>) * kernel != E0(<span class=hljs-number >0</span>)</code></pre> <p>Since <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span></span></span></span> has degree <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>a</mi></msup></mrow><annotation encoding="application/x-tex">2^a</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6644em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span></span></span></span></span></span></span></span>, then in any truncation that we do, we must ensure we do not remove more than 2 isogenies from the path. In practice, this means that we can only perform the truncation if our initial isogeny does not pass through the automorphism <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>φ</mi><mn>3</mn></msub><mo>:</mo><mi>E</mi><mo>→</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">\varphi_3: E \rightarrow E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> in the diagram above. </p> <p>Luckily, the favourable situation is still quite common, as we have a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">1/3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1/3</span></span></span></span> chance for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span></span></span></span> to pass through <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span>, and a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi mathvariant=normal >/</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">2/3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >2/3</span></span></span></span> chance for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6833em;"></span><span class=mord >Φ</span></span></span></span> not to traverse through <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>φ</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">\varphi_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class=mord ><span class="mord mathnormal">φ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Since every time we connect to the server we get a new isogeny, this gives us a small bruteforce on the remote which succeeds with probability <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi mathvariant=normal >/</mi><mn>9</mn></mrow><annotation encoding="application/x-tex">2/9</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >2/9</span></span></span></span>.</p> <h2 id=solve_script ><a href="#solve_script" class=header-anchor >Solve script</a></h2> <p>Below is an implementation of the solve in SageMath</p> <pre><code class="python hljs"><span class=hljs-comment >#!/usr/bin/env python3</span>

<span class=hljs-keyword >from</span> pwn <span class=hljs-keyword >import</span> *

context.log_level = <span class=hljs-string >&quot;debug&quot;</span>

<span class=hljs-keyword >from</span> hashlib <span class=hljs-keyword >import</span> sha256
<span class=hljs-keyword >from</span> Crypto.Util.number <span class=hljs-keyword >import</span> bytes_to_long
<span class=hljs-keyword >import</span> itertools

FAKE_NUM = <span class=hljs-number >3</span>


<span class=hljs-comment ># Base field</span>
a = <span class=hljs-number >49</span>
b = <span class=hljs-number >36</span>
p = <span class=hljs-number >2</span>**a * <span class=hljs-number >3</span>**b - <span class=hljs-number >1</span>


<span class=hljs-keyword >def</span> <span class="hljs-title function_">get_canonical_basis</span>(<span class=hljs-params >E, l, e</span>):
    <span class=hljs-keyword >assert</span> (p + <span class=hljs-number >1</span>) % l ^ e == <span class=hljs-number >0</span>
    P = E(<span class=hljs-number >0</span>)
    <span class=hljs-keyword >while</span> (l ^ (e - <span class=hljs-number >1</span>)) * P == <span class=hljs-number >0</span>:
        P = ((p + <span class=hljs-number >1</span>) // l ^ e) * E.random_point()
    Q = P
    <span class=hljs-keyword >while</span> P.weil_pairing(Q, l ^ e) ^ (l ^ (e - <span class=hljs-number >1</span>)) == <span class=hljs-number >1</span>:
        Q = ((p + <span class=hljs-number >1</span>) // l ^ e) * E.random_point()
    <span class=hljs-keyword >return</span> P, Q


<span class=hljs-keyword >def</span> <span class="hljs-title function_">gen_torsion_points</span>(<span class=hljs-params >E</span>):
    Pa, Qa = get_canonical_basis(E, <span class=hljs-number >2</span>, a)
    Pb, Qb = get_canonical_basis(E, <span class=hljs-number >3</span>, b)
    <span class=hljs-keyword >return</span> Pa, Qa, Pb, Qb


<span class=hljs-keyword >def</span> <span class="hljs-title function_">hash_function</span>(<span class=hljs-params >J</span>):
    <span class=hljs-keyword >return</span> (bytes_to_long(sha256(<span class=hljs-built_in >str</span>(J[<span class=hljs-number >0</span>]).encode()).digest()) // <span class=hljs-number >2</span> * <span class=hljs-number >2</span> + <span class=hljs-number >1</span>) % <span class=hljs-number >2</span> ^ a, (
        bytes_to_long(sha256(<span class=hljs-built_in >str</span>(J[<span class=hljs-number >1</span>]).encode()).digest()) // <span class=hljs-number >2</span> * <span class=hljs-number >2</span> + <span class=hljs-number >1</span>
    ) % <span class=hljs-number >2</span> ^ a


Fp2 = GF(p**<span class=hljs-number >2</span>, <span class=hljs-string >&quot;i&quot;</span>, modulus=[<span class=hljs-number >1</span>, <span class=hljs-number >0</span>, <span class=hljs-number >1</span>])
i = Fp2.gen(<span class=hljs-number >0</span>)

E0 = EllipticCurve(Fp2, [<span class=hljs-number >0</span>, <span class=hljs-number >6</span>, <span class=hljs-number >0</span>, <span class=hljs-number >1</span>, <span class=hljs-number >0</span>])
E0.set_order((p + <span class=hljs-number >1</span>) ** <span class=hljs-number >2</span>)


<span class=hljs-keyword >def</span> <span class="hljs-title function_">send_Fp2</span>(<span class=hljs-params >conn, x</span>):
    conn.sendline(<span class=hljs-built_in >str</span>(x[<span class=hljs-number >0</span>]).encode())
    conn.sendline(<span class=hljs-built_in >str</span>(x[<span class=hljs-number >1</span>]).encode())


<span class=hljs-keyword >def</span> <span class="hljs-title function_">send_ECC_and_points</span>(<span class=hljs-params >conn, E0, P, Q</span>):
    send_Fp2(conn, Fp2(E0.a4()))
    send_Fp2(conn, Fp2(E0.a6()))

    <span class=hljs-comment ># P</span>
    send_Fp2(conn, Fp2(P.x()))
    send_Fp2(conn, Fp2(P.y()))

    <span class=hljs-comment ># Q</span>
    send_Fp2(conn, Fp2(Q.x()))
    send_Fp2(conn, Fp2(Q.y()))


<span class=hljs-keyword >def</span> <span class="hljs-title function_">parse_ec</span>(<span class=hljs-params >line</span>):
    nums = re.findall(<span class=hljs-string >r&quot;[0-9]+&quot;</span>, line)
    E = EllipticCurve(
        Fp2,
        [<span class=hljs-number >0</span>, <span class=hljs-built_in >int</span>(nums[<span class=hljs-number >2</span>]), <span class=hljs-number >0</span>, <span class=hljs-built_in >int</span>(nums[<span class=hljs-number >4</span>]) * i + <span class=hljs-built_in >int</span>(nums[<span class=hljs-number >5</span>]), <span class=hljs-built_in >int</span>(nums[<span class=hljs-number >6</span>]) * i + <span class=hljs-built_in >int</span>(nums[<span class=hljs-number >7</span>])],
    )
    <span class=hljs-keyword >return</span> E


<span class=hljs-keyword >def</span> <span class="hljs-title function_">parse_point</span>(<span class=hljs-params >ec, line</span>):
    lines = line.split(<span class=hljs-string >&quot;=&quot;</span>)[-<span class=hljs-number >1</span>].replace(<span class=hljs-string >&quot;(&quot;</span>, <span class=hljs-string >&quot;&quot;</span>).replace(<span class=hljs-string >&quot;)&quot;</span>, <span class=hljs-string >&quot;&quot;</span>).split(<span class=hljs-string >&quot;:&quot;</span>)
    lines = [line <span class=hljs-keyword >for</span> line <span class=hljs-keyword >in</span> lines <span class=hljs-keyword >if</span> line.strip()]

    <span class=hljs-keyword >return</span> ec(*<span class=hljs-built_in >list</span>(<span class=hljs-built_in >map</span>(<span class=hljs-built_in >eval</span>, lines)))


<span class=hljs-keyword >def</span> <span class="hljs-title function_">eval_point</span>(<span class=hljs-params >curve_name, line</span>):
    <span class=hljs-built_in >exec</span>(line.replace(<span class=hljs-string >&quot;:&quot;</span>, <span class=hljs-string >&quot;,&quot;</span>).replace(<span class=hljs-string >&quot;(&quot;</span>, <span class=hljs-string >f&quot;<span class=hljs-subst >{curve_name}</span>(&quot;</span>))


<span class=hljs-keyword >def</span> <span class="hljs-title function_">compose_all</span>(<span class=hljs-params >factors</span>):
    curr = factors[<span class=hljs-number >0</span>]
    <span class=hljs-keyword >for</span> factor <span class=hljs-keyword >in</span> factors[<span class=hljs-number >1</span>:]:
        curr = factor * curr
    <span class=hljs-keyword >return</span> curr


<span class=hljs-keyword >def</span> <span class="hljs-title function_">find_other_edge</span>(<span class=hljs-params >factor</span>):
    <span class=hljs-keyword >return</span> replacement


<span class=hljs-keyword >def</span> <span class="hljs-title function_">generate_associates</span>(<span class=hljs-params >phi</span>):
    factors = <span class=hljs-built_in >list</span>(phi.factors())
    <span class=hljs-keyword >for</span> j, factor <span class=hljs-keyword >in</span> <span class=hljs-built_in >enumerate</span>(factors):
        source, dest = factor.domain(), factor.codomain()

        <span class=hljs-keyword >if</span> source.j_invariant() == <span class=hljs-number >1728</span> <span class=hljs-keyword >and</span> dest.j_invariant() == E0.j_invariant():
            <span class=hljs-keyword >yield</span> compose_all([E0.isomorphism_to(dest)] + factors[j + <span class=hljs-number >1</span> :])
            <span class=hljs-keyword >for</span> forwardedge <span class=hljs-keyword >in</span> source.isogenies_degree(<span class=hljs-number >2</span>):
                <span class=hljs-keyword >if</span> forwardedge.codomain().is_isomorphic(dest):
                    <span class=hljs-keyword >yield</span> compose_all(factors[:j] + [forwardedge, forwardedge.codomain().isomorphism_to(dest)] + factors[j + <span class=hljs-number >1</span> :])

        <span class=hljs-keyword >if</span> source.j_invariant() == <span class=hljs-number >1728</span> <span class=hljs-keyword >and</span> dest.j_invariant() == <span class=hljs-number >1728</span>:
            <span class=hljs-keyword >yield</span> compose_all(
                factors[:j] + [factors[j - <span class=hljs-number >1</span>].codomain().isomorphism_to(factors[j + <span class=hljs-number >1</span>].domain())] + factors[j + <span class=hljs-number >1</span> :]
            )


<span class=hljs-keyword >def</span> <span class="hljs-title function_">solve</span>():
    <span class=hljs-comment ># conn = process([&quot;sage&quot;, &quot;task.sage&quot;])</span>
    conn = connect(<span class=hljs-string >&quot;instance.penguin.0ops.sjtu.cn&quot;</span>, <span class=hljs-number >18432</span>)

    <span class=hljs-comment ># Get SIDH Parameters</span>
    Pa = parse_point(E0, conn.recvline().decode())
    Qa = parse_point(E0, conn.recvline().decode())
    Pb = parse_point(E0, conn.recvline().decode())
    Qb = parse_point(E0, conn.recvline().decode())

    send_ECC_and_points(conn, E0, Pb, Qb)
    Eb = parse_ec(conn.recvline().decode())

    psiPa = parse_point(Eb, conn.recvline().decode())
    psiQa = parse_point(Eb, conn.recvline().decode())
    J = Eb.j_invariant()
    Sa, Ta = hash_function(J)

    phi_A = E0.isogeny(Sa * Pa + Ta * Qa, algorithm=<span class=hljs-string >&quot;factored&quot;</span>)
    EA = phi_A.codomain()
    associates = <span class=hljs-built_in >list</span>(generate_associates(phi_A))
    <span class=hljs-keyword >if</span> <span class=hljs-keyword >not</span> associates:
        conn.close()
        <span class=hljs-keyword >return</span>

    kernels = <span class=hljs-built_in >set</span>()

    <span class=hljs-keyword >for</span> ass <span class=hljs-keyword >in</span> associates:
        l, e = factor(ass.degree())[<span class=hljs-number >0</span>]
        P, Q = get_canonical_basis(ass.domain(), l, e)
        <span class=hljs-keyword >try</span>:
            kernels.add(P + -ass(P).log(ass(Q)) * Q)
        <span class=hljs-keyword >except</span> ValueError:
            <span class=hljs-keyword >pass</span>
        <span class=hljs-keyword >try</span>:
            kernels.add(Q + -ass(Q).log(ass(P)) * P)
        <span class=hljs-keyword >except</span> ValueError:
            <span class=hljs-keyword >pass</span>

    <span class=hljs-comment ># Remove any invalid associates we overgenerated</span>
    to_remove = <span class=hljs-built_in >set</span>()
    <span class=hljs-keyword >for</span> kernel <span class=hljs-keyword >in</span> kernels:
        <span class=hljs-keyword >if</span> E0.isogeny(kernel, algorithm=<span class=hljs-string >&quot;factored&quot;</span>).codomain().j_invariant() != EA.j_invariant():
            to_remove.add(kernel)
        <span class=hljs-keyword >if</span> <span class=hljs-number >2</span> ^ (a - <span class=hljs-number >2</span>) * kernel == E0(<span class=hljs-number >0</span>):
            to_remove.add(kernel)
    kernels = kernels - to_remove

    <span class=hljs-comment ># Find a linearly independent subset</span>
    final = <span class=hljs-built_in >set</span>()
    <span class=hljs-keyword >for</span> perm <span class=hljs-keyword >in</span> itertools.combinations(kernels, r=<span class=hljs-number >3</span>):
        s = <span class=hljs-built_in >set</span>()
        <span class=hljs-keyword >for</span> kernel <span class=hljs-keyword >in</span> perm:
            <span class=hljs-keyword >if</span> <span class=hljs-built_in >all</span>(kernel.weil_pairing(PP, <span class=hljs-number >2</span> ^ a) != <span class=hljs-number >1</span> <span class=hljs-keyword >for</span> PP <span class=hljs-keyword >in</span> s):
                s.add(kernel)
            <span class=hljs-keyword >else</span>:
                <span class=hljs-keyword >break</span>
        <span class=hljs-keyword >if</span> <span class=hljs-built_in >len</span>(s) &gt; <span class=hljs-built_in >len</span>(final):
            final = s

    <span class=hljs-keyword >if</span> <span class=hljs-built_in >len</span>(final) &lt; <span class=hljs-number >3</span>:
        conn.close()
        <span class=hljs-keyword >return</span>

    <span class=hljs-comment ># Now we have a set of 3 linearly independent kernels, and can complete the proof.</span>
    <span class=hljs-keyword >for</span> kernel <span class=hljs-keyword >in</span> final:
        <span class=hljs-comment ># Send kernel</span>
        send_Fp2(conn, Fp2(kernel.x()))
        send_Fp2(conn, Fp2(kernel.y()))
        P0 = parse_point(E0, conn.recvline_startswith(<span class=hljs-string >b&quot;self.P0&quot;</span>).decode())
        Q0 = parse_point(E0, conn.recvline_startswith(<span class=hljs-string >b&quot;self.Q0&quot;</span>).decode())

        <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class=hljs-number >16</span>):
            <span class=hljs-comment ># commit</span>
            <span class=hljs-comment ># E2</span>
            conn.recvuntil(<span class=hljs-string >b&quot;Give me E2:&quot;</span>)
            send_Fp2(conn, Fp2(E0.a4()))
            send_Fp2(conn, Fp2(E0.a6()))
            P2 = parse_point(E0, conn.recvline_startswith(<span class=hljs-string >b&quot;self.P2&quot;</span>).decode())
            Q2 = parse_point(E0, conn.recvline_startswith(<span class=hljs-string >b&quot;self.Q2&quot;</span>).decode())

            <span class=hljs-comment ># EA</span>
            send_ECC_and_points(conn, EA, phi_A(P2), phi_A(Q2))

            <span class=hljs-comment ># Chall</span>
            chall = <span class=hljs-built_in >int</span>(conn.recvline_startswith(<span class=hljs-string >b&quot;chall = &quot;</span>).split(<span class=hljs-string >b&quot;=&quot;</span>)[-<span class=hljs-number >1</span>].decode())
            <span class=hljs-keyword >if</span> chall:
                <span class=hljs-comment ># Reveal kernel</span>
                orig_kernel = Sa * Pa + Ta * Qa
                send_Fp2(conn, Fp2(orig_kernel.x()))
                send_Fp2(conn, Fp2(orig_kernel.y()))
            <span class=hljs-keyword >else</span>:
                <span class=hljs-comment ># Send identity isogenies</span>
                conn.sendline(<span class=hljs-string >f&quot;<span class=hljs-subst >{<span class=hljs-number >3</span>^b}</span>,<span class=hljs-subst >{<span class=hljs-number >3</span>^b}</span>&quot;</span>.encode())
    <span class=hljs-built_in >print</span>(conn.recvall())
    <span class=hljs-keyword >return</span> <span class=hljs-literal >True</span>


<span class=hljs-keyword >def</span> <span class="hljs-title function_">main</span>():
    <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(<span class=hljs-number >100</span>):
        solved = solve()
        <span class=hljs-keyword >if</span> solved:
            <span class=hljs-keyword >break</span></code></pre> <h2 id=flag ><a href="#flag" class=header-anchor >Flag</a></h2> <pre><code class="text hljs">0ops{https://eprint.iacr.org/2022/475.pdf_1s_ju5t_a_proof_0f_know1edge.&gt;.&lt;.././././}</code></pre>
</div>
        </div> 
    </div> 
    
        



    
    
        <script src="/wednesday/libs/highlight/highlight.min.js"></script>
<script src="/wednesday/libs/highlight/rust.min.js"></script>
<script src="/wednesday/libs/highlight/csharp.min.js"></script>
<script>hljs.highlightAll();hljs.configure({tabReplace: '    '});</script>